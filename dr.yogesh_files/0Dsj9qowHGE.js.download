;/*FB_PKG_DELIM*/

__d("IWAAPI",["WABridge"],(function(a,b,c,d,e,f,g){"use strict";b=1;function a(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("WABridge").getBridge().sendAndReceive("backend","waapi",{type:a,args:c})}}g.version=b;g.makeBridgedApi=a}),98);
__d("LSCoreClientFolderType",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:0,PENDING:1,OTHER:2,SPAM:3,ARCHIVED:4,HIDDEN:5,MARKETPLACE:12,RESTRICTED:15,INTEROP:19});f["default"]=a}),66);
__d("LSCreateE2EEMetadataThread",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][createE2EEMetadataThread] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[19]=new c.Map(),d[19].set("error_msg","Expected a nonempty query result"),d[19].set("code",c.i64.cast([0,3])),d[19].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[20]=c.createArray(),d[21]=(d[20].push(d[19]),d[20]),e=[void 0,d[20]],d[2]=e[0],d[3]=e[1],e):(b=a.item,d[19]=new c.Map(),d[19].set("backup_id",b.backupId),d[19].set("device_public_key_blob",b.devicePublicKeyBlob),d[19].set("device_private_key_blob",b.devicePrivateKeyBlob),d[19].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[19].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[19].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[19].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[19].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[19].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[19].set("orf_client_state_v2_blob",void 0),d[19].set("orf_v2_authority_level",void 0),d[19].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[19].set("device_id",b.deviceId),d[19].set("backup_tenancy",b.backupTenancy),d[19].set("encryption_version",b.encryptionVersion),d[19].set("revision_version",b.revisionVersion),d[19].set("initialize_restore_result",void 0),d[19].set("authority_level",b.authorityLevel),e=[d[19],void 0],d[2]=e[0],d[3]=e[1],e)})},function(a){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(a){return d[19]=d[6].get("backup_id"),d[20]=d[6].get("device_public_key_blob"),d[21]=d[6].get("device_private_key_blob"),d[22]=d[6].get("epoch_storage_public_key_blob"),d[23]=d[6].get("epoch_storage_private_key_blob"),d[24]=d[6].get("epoch_auth_public_key_blob"),d[25]=d[6].get("epoch_auth_private_key_blob"),d[26]=d[6].get("mailbox_root_key_blob"),d[27]=d[6].get("ocmf_client_state_blob"),d[28]=d[6].get("orf_client_state_v2_blob"),d[29]=d[6].get("orf_v2_authority_level"),d[30]=d[6].get("oblivious_validation_token_blob"),d[31]=d[6].get("device_id"),d[32]=d[6].get("backup_tenancy"),d[33]=d[6].get("encryption_version"),d[34]=d[6].get("revision_version"),d[35]=d[6].get("initialize_restore_result"),d[36]=d[6].get("authority_level"),c.i64.neq(d[31],void 0)?c.sequence([function(a){return d[38]=void 0,c.i64.neq(d[38],void 0)?c.resolve(d[39]=d[38]):c.sequence([function(a){return d[51]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[52]?d[61]=(d[51].push(c.i64.cast([0,0])),d[51]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]?d[61]=(d[51].push(c.i64.cast([0,2])),d[51]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[54]?d[61]=(d[51].push(c.i64.cast([0,3])),d[51]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[61]=(d[51].push(c.i64.cast([0,4])),d[51]):0,d[56]=c.createArray(),d[57]=c.i64.of_int32(d[51].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[61]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],d[61]).then(function(a){return a=a,d[62]=a[0],d[63]=a[1],a})},function(a){return d[64]=(d[56].push(d[62]),d[56])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[61]=c.createArray(),d[62]=c.i64.of_int32(d[56].length),c.i64.gt(d[62],c.i64.cast([0,0]))?c.loopAsync(d[62],function(a){return d[64]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[56],d[64]).then(function(a){return a=a,d[65]=a[0],d[66]=a[1],a})},function(a){return d[67]=(d[61].push(c.i64.to_string(d[65])),d[61])}])}):c.resolve()},function(a){return d[63]=d[61].join(","),d[58]=d[63]}])},function(a){return d[56].some(function(a){return c.i64.eq(d[33],a)})?d[59]=d[33]:d[59]=void 0,c.i64.neq(d[59],void 0)?d[60]=d[59]:d[60]=void 0,d[39]=d[60]}])},function(a){return c.i64.neq(d[39],void 0)?d[40]=d[39]:d[40]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[41]=d[32]:d[41]=c.i64.cast([0,1]),c.nativeOperation(b("LSBase64Encode.nop"),d[27]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[26]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[44]=new c.Map(),d[44].set("ocmf_client_state_blob",d[42]==null?"":d[42]),d[44].set("mailbox_root_key",d[43]==null?"":d[43]),d[45]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[51]=(d[45].push(a.epochId),d[45])})},function(a){return d[49]="Queried locally available epochs. Count: ",d[46]=c.i64.of_int32(d[45].length),d[50]=c.i64.to_string(d[46]),d[47]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[47],d[49],d[47],d[50]].join("")),c.resolve()},function(a){return d[48]=new c.Map(),d[48].set("device_id",d[31]),d[48].set("raw_tokens",d[44]),d[48].set("locally_available_epochs",d[45]),d[37]=d[48]}]):c.resolve(d[37]=void 0)},function(a){return d[7]=d[37]}]):c.resolve((d[19]=d[5].get("errors"),d[20]=d[5].get("errors"),d[7]=void 0))},function(e){return d[8]=c.i64.random(),d[9]=c.i64.to_string(d[8]),d[10]=new c.Map(),d[10].set("wa_jid",a[0]),d[10].set("offline_thread_key",a[1]),d[10].set("thread_type",a[2]),d[10].set("folder_type",a[3]),d[10].set("bump_timestamp_ms",a[4]),d[10].set("tam_thread_subtype",c.i64.cast([0,0])),d[10].set("created_by_local_device",a[5]),d[10].set("device_context",d[7]),d[10].set("qpl_instance_key",d[9]),d[11]=d[10].get("offline_thread_key"),d[12]=c.toJSON(d[10]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[11]),c.i64.cast([0,388]),d[12],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[13]=c.i64.of_float(Date.now()),d[14]=c.i64.random(),d[16]="Finishing execution. Execution time: ",d[17]=c.i64.to_string(c.i64.sub(d[13],d[0])),d[18]=" ms",d[15]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][createE2EEMetadataThread] ",d[15],d[16],d[15],d[17],d[15],d[18]].join("")),c.i64.eq(c.i64.mod_(d[14],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[19]=",",d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"createE2EEMetadataThread",[d[16],d[19],d[17],d[19],d[18]].join(""),d[20],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCreateE2EEMetadataThreadStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSCreateE2EEMetadataThreadStoredProcedure",["LSCreateE2EEMetadataThread","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCreateE2EEMetadataThread"),e.waJid,e.offlineThreadKey,e.threadType,e.folderType,e.bumpTimestampMs,e.createdByLocalDevice);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSCreateOfflineThreadingIDStoredProcedure",["LSCreateOfflineThreadingID","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCreateOfflineThreadingID"),e.timestampMs);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSRtcCallState",[],(function(a,b,c,d,e,f){a=Object.freeze({NO_ONGOING_CALL:0,AUDIO_GROUP_CALL:1,VIDEO_GROUP_CALL:2,VIDEO_1TO1_CALL:3,AUDIO_1TO1_CALL:4});f["default"]=a}),66);
__d("LSThreadPointQueryAndRestoreMessagesWithJID",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][ThreadPointQueryAndRestoreMessagesWithJID] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[19]=new c.Map(),d[19].set("error_msg","Expected a nonempty query result"),d[19].set("code",c.i64.cast([0,3])),d[19].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[20]=c.createArray(),d[21]=(d[20].push(d[19]),d[20]),e=[void 0,d[20]],d[2]=e[0],d[3]=e[1],e):(b=a.item,d[19]=new c.Map(),d[19].set("backup_id",b.backupId),d[19].set("device_public_key_blob",b.devicePublicKeyBlob),d[19].set("device_private_key_blob",b.devicePrivateKeyBlob),d[19].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[19].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[19].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[19].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[19].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[19].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[19].set("orf_client_state_v2_blob",void 0),d[19].set("orf_v2_authority_level",void 0),d[19].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[19].set("device_id",b.deviceId),d[19].set("backup_tenancy",b.backupTenancy),d[19].set("encryption_version",b.encryptionVersion),d[19].set("revision_version",b.revisionVersion),d[19].set("initialize_restore_result",void 0),d[19].set("authority_level",b.authorityLevel),e=[d[19],void 0],d[2]=e[0],d[3]=e[1],e)})},function(a){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(a){return d[19]=d[6].get("backup_id"),d[20]=d[6].get("device_public_key_blob"),d[21]=d[6].get("device_private_key_blob"),d[22]=d[6].get("epoch_storage_public_key_blob"),d[23]=d[6].get("epoch_storage_private_key_blob"),d[24]=d[6].get("epoch_auth_public_key_blob"),d[25]=d[6].get("epoch_auth_private_key_blob"),d[26]=d[6].get("mailbox_root_key_blob"),d[27]=d[6].get("ocmf_client_state_blob"),d[28]=d[6].get("orf_client_state_v2_blob"),d[29]=d[6].get("orf_v2_authority_level"),d[30]=d[6].get("oblivious_validation_token_blob"),d[31]=d[6].get("device_id"),d[32]=d[6].get("backup_tenancy"),d[33]=d[6].get("encryption_version"),d[34]=d[6].get("revision_version"),d[35]=d[6].get("initialize_restore_result"),d[36]=d[6].get("authority_level"),c.i64.neq(d[31],void 0)?c.sequence([function(a){return d[38]=void 0,c.i64.neq(d[38],void 0)?c.resolve(d[39]=d[38]):c.sequence([function(a){return d[51]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[52]?d[61]=(d[51].push(c.i64.cast([0,0])),d[51]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]?d[61]=(d[51].push(c.i64.cast([0,2])),d[51]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[54]?d[61]=(d[51].push(c.i64.cast([0,3])),d[51]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[61]=(d[51].push(c.i64.cast([0,4])),d[51]):0,d[56]=c.createArray(),d[57]=c.i64.of_int32(d[51].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[61]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],d[61]).then(function(a){return a=a,d[62]=a[0],d[63]=a[1],a})},function(a){return d[64]=(d[56].push(d[62]),d[56])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[61]=c.createArray(),d[62]=c.i64.of_int32(d[56].length),c.i64.gt(d[62],c.i64.cast([0,0]))?c.loopAsync(d[62],function(a){return d[64]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[56],d[64]).then(function(a){return a=a,d[65]=a[0],d[66]=a[1],a})},function(a){return d[67]=(d[61].push(c.i64.to_string(d[65])),d[61])}])}):c.resolve()},function(a){return d[63]=d[61].join(","),d[58]=d[63]}])},function(a){return d[56].some(function(a){return c.i64.eq(d[33],a)})?d[59]=d[33]:d[59]=void 0,c.i64.neq(d[59],void 0)?d[60]=d[59]:d[60]=void 0,d[39]=d[60]}])},function(a){return c.i64.neq(d[39],void 0)?d[40]=d[39]:d[40]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[41]=d[32]:d[41]=c.i64.cast([0,1]),c.nativeOperation(b("LSBase64Encode.nop"),d[27]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[26]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[44]=new c.Map(),d[44].set("ocmf_client_state_blob",d[42]==null?"":d[42]),d[44].set("mailbox_root_key",d[43]==null?"":d[43]),d[45]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[51]=(d[45].push(a.epochId),d[45])})},function(a){return d[49]="Queried locally available epochs. Count: ",d[46]=c.i64.of_int32(d[45].length),d[50]=c.i64.to_string(d[46]),d[47]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[47],d[49],d[47],d[50]].join("")),c.resolve()},function(a){return d[48]=new c.Map(),d[48].set("device_id",d[31]),d[48].set("raw_tokens",d[44]),d[48].set("locally_available_epochs",d[45]),d[37]=d[48]}]):c.resolve(d[37]=void 0)},function(a){return d[7]=d[37]}]):c.resolve((d[19]=d[5].get("errors"),d[20]=d[5].get("errors"),d[7]=void 0))},function(e){return d[8]=c.i64.random(),d[9]=c.i64.to_string(d[8]),d[10]=new c.Map(),d[10].set("wa_jid",a[0]),d[10].set("tam_thread_subtype",c.i64.cast([0,0])),d[10].set("enable_logging_for_tpq",!1),d[10].set("device_context",d[7]),d[10].set("qpl_instance_key",d[9]),d[11]=d[10].get("wa_jid"),d[12]=c.toJSON(d[10]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[11]),c.i64.cast([0,556]),d[12],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[13]=c.i64.of_float(Date.now()),d[14]=c.i64.random(),d[16]="Finishing execution. Execution time: ",d[17]=c.i64.to_string(c.i64.sub(d[13],d[0])),d[18]=" ms",d[15]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][ThreadPointQueryAndRestoreMessagesWithJID] ",d[15],d[16],d[15],d[17],d[15],d[18]].join("")),c.i64.eq(c.i64.mod_(d[14],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[19]=",",d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"ThreadPointQueryAndRestoreMessagesWithJID",[d[16],d[19],d[17],d[19],d[18]].join(""),d[20],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure",["LSSynchronousPromise","LSThreadPointQueryAndRestoreMessagesWithJID","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSThreadPointQueryAndRestoreMessagesWithJID"),e.waJid);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWBridgeGroupInviteLoadedHandler",["fbt","I64","LSMessagingThreadTypeUtil","MAWMiActMappingTableAPI","Promise","ReQL","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;function a(a,b,c){return l(a,c,b.actorId)}function k(a,c,e){return d("MAWMiActMappingTableAPI").getThreadKeyForChatJid(a,c).then(function(c){return c==null?(j||(j=b("Promise"))).resolve():l(a,c,e)})}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=a.threads,g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(f).getKeyRange(b)));if(g==null)return;var j=d("LSMessagingThreadTypeUtil").isGroup(g.threadType);if(!j)return;j=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.group_invites).getKeyRange(b)));if(j==null){c("justknobx")._("1162")&&(yield f.put(babelHelpers["extends"]({},g,{additionalThreadContext:void 0})));return}b=(i||(i=d("I64"))).equal((i||(i=d("I64"))).of_string(e),j.inviterId)?null:yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts,["name"]).getKeyRange(j.inviterId));if(b==null)return;e=h._(/*BTDS*/"__JHASH__UJFQkCMRFkv__JHASH__",[h._param("Inviter Name",b.name)]).toString();a=g.folderName==="inbox"?h._(/*BTDS*/"__JHASH__4F6x7gUU1-S__JHASH__").toString():g.additionalThreadContext;yield f.put(babelHelpers["extends"]({},g,{additionalThreadContext:a,snippet:e}))});return m.apply(this,arguments)}function e(a,b){return k(a,b.threadJid,b.actorId)}function f(a,b,c){return k(a,b,c)}g.callForOneDb=a;g.call=e;g.callFromMainThread=f}),226);
__d("MAWContactRelationshipType",["I64","LSContactBitOffset","WADbContact"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=d("LSContactBitOffset").hasWithDefault(64,a,!0);a=(h||(h=d("I64"))).ge(a.contactViewerRelationship,h.of_string("2"));if(a&&b)return d("WADbContact").ONE_WAY_CONTACT;else if(!a&&!b)return d("WADbContact").REVERSED_ONE_WAY_CONTACT;else if(a&&!b)return d("WADbContact").TWO_WAY_CONTACT;return d("WADbContact").NON_CONTACT}g.getContactRelationshipType=a}),98);
__d("MAWBridgeOneToOneMessageRequestLoadedHandler",["fbt","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWContactRelationshipType","MAWJids","MAWMessageRequestUtil","MAWMiActMappingTableAPI","ODS","Promise","ReQL","WADbContact","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l;function a(a,b){b=b.threadJid;return m(a,b)}function e(a,b){return m(a,b)}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=d("MAWJids").convertChatJidToIntJid(c);c=(yield d("MAWMiActMappingTableAPI").getThreadKeyForChatJid(a,c));if(c==null)return;c=(yield (l||(l=b("Promise"))).all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(c)),d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts).getKeyRange(e))]));e=c[0];c=c[1];if(e==null||c==null||!d("LSMessagingThreadTypeUtil").isOneToOne(e.threadType))return;c=o(e,c);c=e.folderName==="pending"||e.folderName==="other"||e.folderName==="spam"||c;if(!c)return;c=e.folderName==="inbox"?h._(/*BTDS*/"__JHASH__4F6x7gUU1-S__JHASH__").toString():void 0;c=babelHelpers["extends"]({},e,{additionalThreadContext:c},p(e));yield a.threads.put(c)});return n.apply(this,arguments)}function o(a,b){var e=d("MAWContactRelationshipType").getContactRelationshipType(b);e=a.folderName==="inbox"&&e===d("WADbContact").REVERSED_ONE_WAY_CONTACT&&!(i||(i=d("I64"))).equal(a.lastActivityTimestampMs,(i||(i=d("I64"))).zero);a=(i||(i=d("I64"))).lt(b.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE));e&&!a&&(k||(k=d("ODS"))).bumpEntityKey(3185,"e2ee.message_request_loaded_failure","contacts_not_yet_loaded",1);return e&&a}function p(a){a=d("LSThreadBitOffset").clear(d("MAWMessageRequestUtil").disabledThreadCapabilitiesForIncomingRequest,a.capabilities,a.capabilities2,a.capabilities3,a.capabilities4,a.capabilities5);a=d("LSThreadBitOffset").set(d("MAWMessageRequestUtil").enabledThreadCapabilitiesForIncomingRequest,a[0],a[1],a[2],a[3],a[4]);return{capabilities:a[0],capabilities2:a[1],capabilities3:a[2],capabilities4:a[3],capabilities5:a[4]}}g.call=a;g.callFromMainThread=e}),226);
__d("MAWActThreadMapping",["I64","MAWBridgeGroupInviteLoadedHandler","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeSendAndReceive","MAWCurrentUser","MAWJids","MAWMiActMappingTableAPI","MAWMiActOnActThreadReadyQueue","MAWThreadMappingQPL","Promise","WAJids","asyncToGeneratorRuntime","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Map(),k=null;function l(){return c("gkx")("14178")}function m(a,b,d,e){var g=e.then(function(b){c("promiseDone")(a.runInTransaction(function(a){return s(a,p(b),d)},"readwrite",void 0,void 0,f.id+":65"));return b});b.forEach(function(a){return j.set(a,g)})}function n(a){return(i||(i=b("Promise"))).all(Array.from(a).map(function(a){var b=a[0];a=a[1];return a.then(function(a){a=a.find(function(a){return((a=a.value)==null?void 0:a.chatJid)===b});return(a==null?void 0:a.status)==="fulfilled"?{status:"fulfilled",value:babelHelpers["extends"]({},a.value,{isCreated:!1})}:{reason:a==null?void 0:a.reason,status:"rejected"}})}))}function o(a){var b=new Map(),c=new Map();a.threads.forEach(function(a){var e=j.get(a.chatJid);e!=null?(a.instanceKey!=null&&d("MAWThreadMappingQPL").addPoint("reuse_existing_promise_for_act_mapping",a.instanceKey),c.set(a.chatJid,e)):b.set(a.chatJid,a)});return{cachedPromisesByJid:c,threadsToVerifyByJid:b}}function p(a){var b=new Map();a.forEach(function(a){a.status==="fulfilled"&&b.set(a.value.chatJid,a.value)});return b}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","bulkCreateOrUpdateThread",b));c("promiseDone")(a.runInTransaction(function(a){return s(a,p(e),b)},"readwrite",void 0,void 0,f.id+":160"));return e});return r.apply(this,arguments)}function a(a,c){if(!l())return q(a,c);k==null&&(k=u(a));var e=o(c),f=e.cachedPromisesByJid;e=e.threadsToVerifyByJid;f=n(f);if(e.size===0)return f;var g=d("MAWBridgeSendAndReceive").sendAndReceive("backend","bulkCreateOrUpdateThread",babelHelpers["extends"]({},c,{threads:Array.from(e.values())}));m(a,Array.from(e.keys()),c,g);return(i||(i=b("Promise"))).all([g,f]).then(function(a){var b=a[0];a=a[1];return b.concat(a)})}function e(a){var b=a.authoritativeThreadKey,e=a.description,f=a.instanceKey,g=a.jid;a=a.optimisticThreadKey;f!=null&&d("MAWMiActOnActThreadReadyQueue").logOnFlushQueue(a,b,f,e);a!=null&&c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady((h||(h=d("I64"))).of_string(a),g,e,"clientThreadKey"));b!=null&&c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady((h||(h=d("I64"))).of_string(b),g,e,"authoritativeThreadKey"))}function s(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=[],h=d("MAWCurrentUser").getID(),j=c("gkx")("14386");yield (i||(i=b("Promise"))).all(f.threads.map(function(f){var k=f.authoritativeThreadKey,l=f.chatJid;f=f.instanceKey;var m=e.get(l);if(m==null)return(i||(i=b("Promise"))).resolve();var n=m.clientThreadKey,o=m.folder,p=m.lastActivityTs;m=m.participants;m.forEach(function(a){g.push(babelHelpers["extends"]({},a,{chatJid:l}))});m=d("WAJids").switchOnMsgrChatJidType(l,{group:function(a){return!0},user:function(a){return!1}});j&&c("promiseDone")(m?d("MAWBridgeGroupInviteLoadedHandler").callFromMainThread(a,l,h):d("MAWBridgeOneToOneMessageRequestLoadedHandler").callFromMainThread(a,l));return d("MAWBridgeOccamadilloVerifyThreadExistsHandler").callFromMainThread(a,{authoritativeThreadKey:k,clientThreadKey:n,description:"bulkCreateThreadWithoutAfterTxn",folder:o,instanceKey:f,isGroup:m,jid:l,lastActivityTs:p})}));c("gkx")("13628")&&(yield d("MAWBridgeParticipantsUpdatedHandler").callFromMainThread(a,g))});return t.apply(this,arguments)}function u(a){return d("MAWMiActMappingTableAPI").subscribeToMappingDeletion(a,function(a,b){b=d("MAWJids").convertIntJidToOneToOneChatJid(a);j.has(b)&&j["delete"](b);b=d("MAWJids").convertIntJidToGroupJid(a);j.has(b)&&j["delete"](b)})}g.bulkVerifyThreadExistsInWorker=a;g.executePromisesBlockedOnActThreadMapping=e}),98);
__d("MAWBridgeFireAndForget",["MAWBridge","MAWBridgeLoggingUtils","MAWTimedBridge","MAWWaitForBackendSetup","MAWWorkerEvent","Promise","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("justknobx")._("1143");function a(a,c,e,f){return d("MAWWaitForBackendSetup").runAfterBackendSetup(function(){var g=d("MAWBridgeLoggingUtils").getBridgeEventInstanceKey(c);f!==!0&&d("MAWBridgeLoggingUtils").routeStart("fireAndForget",a,c,g);void d("MAWTimedBridge").bridgeTimeout(function(){return new(h||(h=b("Promise")))(function(b){d("MAWBridge").getBridge().fireAndForget(a,c,e,f,{onAck:function(e){f!==!0&&(d("MAWWorkerEvent").logAck(g,c,e),d("MAWBridgeLoggingUtils").routeSuccess(a,c,g)),b()},onSend:function(a){var b=a.queueMsgs;a=a.queueSize;f!==!0&&(d("MAWWorkerEvent").logSend(g,c,"fireAndForget"),d("MAWWorkerEvent").logAnnotations(g,{"int":{bridgeSize:a},string_array:{bridgeMsgs:b}}))}},{bridgeQPLInstanceKey:g})})},a,c,g,i)},c)}g.fireAndForget=a}),98);
__d("MAWCreateOptimisticThread",["I64","LSAuthorityLevel","LSCreateOfflineThreadingIDStoredProcedure","LSFactory","LSIntEnum","LSMailboxType","LSRtcCallState","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield c("LSCreateOfflineThreadingIDStoredProcedure")(c("LSFactory")(a),{timestampMs:(h||(h=d("I64"))).of_float(Date.now())}));a=a[0];return a});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e={authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),folderName:"inbox",lastReadWatermarkTimestampMs:(h||(h=d("I64"))).of_float(0),mailboxType:i.ofNumber(c("LSMailboxType").MESSENGER),ongoingCallState:i.ofNumber(c("LSRtcCallState").NO_ONGOING_CALL),parentThreadKey:h.zero,threadKey:b,threadType:i.ofNumber(15)};yield a.threads.put(e);return b});return m.apply(this,arguments)}function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield j(a));yield l(a,b);return b});return n.apply(this,arguments)}g.createOfflineThreadingId=j;g.createOptimisticThreadWithThreadKey=l;g.createOptimisticThread=a}),98);
__d("MessagingFolderTag",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:"inbox",OTHER:"other",SPAM:"spam",PENDING:"pending",MONTAGE:"montage",HIDDEN:"hidden",LEGACY:"legacy",DISABLED:"disabled",PAGE_BACKGROUND:"page_background",PAGE_DONE:"page_done",BLOCKED:"blocked",COMMUNITY:"community",RESTRICTED:"restricted",BC_PARTNERSHIP:"bc_partnership",E2EE_CUTOVER:"e2ee_cutover",E2EE_CUTOVER_ARCHIVED:"e2ee_cutover_archived",E2EE_CUTOVER_PENDING:"e2ee_cutover_pending",E2EE_CUTOVER_OTHER:"e2ee_cutover_other",INTEROP:"interop",ARCHIVED:"archived",AI_ACTIVE:"ai_active",SALSA_RESTRICTED:"salsa_restricted",MESSENGER_MARKETING_MESSAGE:"messenger_marketing_message",SECRET_CONVERSATIONS:"secret_conversations",WEBCHAT_PLUGIN:"webchat_plugin",NFB_OVERFLOW:"nfb_overflow",UNKNOWN:""});f["default"]=a}),66);
__d("MAWFolderUtils",["FBLogger","I64","LSCoreClientFolderType","LSIntEnum","MAWFolderTypes","MessagingFolderTag"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){switch(a){case d("MAWFolderTypes").PENDING:return c("MessagingFolderTag").PENDING;case d("MAWFolderTypes").OTHER:return c("MessagingFolderTag").OTHER;case d("MAWFolderTypes").SPAM:return c("MessagingFolderTag").SPAM;case d("MAWFolderTypes").ARCHIVED:return c("MessagingFolderTag").UNKNOWN;default:return c("MessagingFolderTag").INBOX}}function b(a){switch(a){case d("MAWFolderTypes").PENDING:return(h||(h=d("LSIntEnum"))).ofNumber(-101);case d("MAWFolderTypes").OTHER:return(h||(h=d("LSIntEnum"))).ofNumber(-102);case d("MAWFolderTypes").SPAM:return(h||(h=d("LSIntEnum"))).ofNumber(-103);case d("MAWFolderTypes").ARCHIVED:return(h||(h=d("LSIntEnum"))).ofNumber(-110);default:return(h||(h=d("LSIntEnum"))).ofNumber(-100)}}function e(a){switch(a){case d("MAWFolderTypes").ARCHIVED:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").ARCHIVED);case d("MAWFolderTypes").INBOX:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").INBOX);case d("MAWFolderTypes").OTHER:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").SPAM);case d("MAWFolderTypes").PENDING:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").OTHER);case d("MAWFolderTypes").RESTRICTED:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").RESTRICTED);case d("MAWFolderTypes").SPAM:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").PENDING);default:a;throw c("FBLogger")("messenger_web").mustfixThrow("Unhandled folder ID: "+a)}}function f(a){switch(a){case(h||(h=d("LSIntEnum"))).ofNumber(-1):return(h||(h=d("LSIntEnum"))).ofNumber(-101);case(h||(h=d("LSIntEnum"))).ofNumber(-2):return(h||(h=d("LSIntEnum"))).ofNumber(-102);case(h||(h=d("LSIntEnum"))).ofNumber(-3):return(h||(h=d("LSIntEnum"))).ofNumber(-103);case(h||(h=d("LSIntEnum"))).ofNumber(-10):return(h||(h=d("LSIntEnum"))).ofNumber(-110);default:return(h||(h=d("LSIntEnum"))).ofNumber(-100)}}function j(a){switch(a){case"inbox":return d("MAWFolderTypes").FOLDER_ID.INBOX;case"pending":return d("MAWFolderTypes").FOLDER_ID.PENDING;case"spam":return d("MAWFolderTypes").FOLDER_ID.SPAM;case"archived":return d("MAWFolderTypes").FOLDER_ID.ARCHIVED;case"other":return d("MAWFolderTypes").FOLDER_ID.OTHER;case"restricted":return d("MAWFolderTypes").FOLDER_ID.RESTRICTED;default:return null}}function k(a){switch((i||(i=d("I64"))).to_int32(a)){case d("MAWFolderTypes").FOLDER_ID.INBOX:return 0;case d("MAWFolderTypes").FOLDER_ID.PENDING:return-1;case d("MAWFolderTypes").FOLDER_ID.SPAM:return-3;case d("MAWFolderTypes").FOLDER_ID.ARCHIVED:return-10;case d("MAWFolderTypes").FOLDER_ID.OTHER:return-2;default:return null}}g.getMessagingFolderTag=a;g.getClientSystemFolder=b;g.systemFolderToLSCoreClientFolder=e;g.systemFolderToClientSystemFolder=f;g.folderTagToFolderId=j;g.parentThreadKeyToLsSystemFolder=k}),98);
__d("MAWCreateOptimisticMiThreadForActThread",["DateConsts","FBLogger","I64","LSCoreClientFolderType","LSCreateE2EEMetadataThreadStoredProcedure","LSFactory","LSIntEnum","LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure","MAWCreateOptimisticThread","MAWFolderUtils","MAWLoggerDeferred","MAWThreadMappingQPL","MAWThreadMappingState","MAWThreadUpdateMiddlewareGatingUtil","MAWTimeUtils","Promise","WATimeUtils","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Creating e2ee metadata optimistic thread.\n  threadKey: ","\n  bumpTimestampMs: ",",\n  description: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Notifying MI server about thread: int jid ",", state: ",". "]);l=function(){return a};return a}var m=(j||(j=d("I64"))).of_int32(c("LSCoreClientFolderType").INBOX);function n(a){if(a==null){c("FBLogger")("messenger_web").warn("[Occam] no folder ID was supplied to Occamadillo verify thread exists handler");return m}return d("MAWFolderUtils").systemFolderToLSCoreClientFolder(a)}function a(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=e.authoritativeThreadKey,i=e.clientThreadKey,k=e.description,l=e.folder,m=e.instanceKey,n=e.intJid,o=e.isGroup;e=e.lastActivityTs;var p=d("MAWThreadUpdateMiddlewareGatingUtil").isNewMiThreadCreationFlowEnabled("exposure_logging_enabled");m!=null&&d("MAWThreadMappingQPL").addAnnotations({bool:{isNewServerThreadCreationFlowEnabled:p}},m);if(p)i!=null&&(yield d("MAWThreadMappingState").markActThreadMappingAsCompleted(a,{intJid:n,threadKey:(j||(j=d("I64"))).of_string(i)},m),yield d("MAWThreadMappingQPL").measurePerformanceForNullableInstanceKey("thread_point_query_sproc",m,function(){return c("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure")(c("LSFactory")(a),{waJid:n})}));else{p=i!=null?(j||(j=d("I64"))).of_string(i):yield d("MAWCreateOptimisticThread").createOptimisticThread(a);yield (h||(h=b("Promise"))).all([yield q(a,{i64ClientThreadKey:p,intJid:n,mawThread:{authoritativeThreadKey:g,description:k,folder:l,instanceKey:m,isGroup:o,lastActivityTs:e},threadLifecycleState:f}),yield d("MAWThreadMappingState").markActThreadMappingAsCompleted(a,{intJid:n,threadKey:p},m)])}});return o.apply(this,arguments)}function p(a){a=d("MAWTimeUtils").millisTimeToTimestamp(a);return(j||(j=d("I64"))).equal(a,(j||(j=d("I64"))).zero)?d("MAWTimeUtils").millisTimeToTimestamp(d("WATimeUtils").millisTime()):a}function q(a,b){var e=b.i64ClientThreadKey,f=b.intJid,g=b.mawThread;b=b.threadLifecycleState;c("promiseDone")(d("MAWLoggerDeferred").LOG(l(),f,b==null?void 0:b.type));var h=c("LSFactory")(a),m=p(g.lastActivityTs),o=n(g.folder),q=g.isGroup?(i||(i=d("LSIntEnum"))).ofNumber(16):(i||(i=d("LSIntEnum"))).ofNumber(15);a=(j||(j=d("I64"))).to_string(e);var r=g.description;c("promiseDone")(d("MAWLoggerDeferred").LOG(k(),a,j.to_string(m),r));a=d("WATimeUtils").millisTime();var s=j.to_float(m);Math.abs(s-a)<d("DateConsts").MS_PER_SEC&&c("FBLogger")("messenger_web").warn("[GetOrCreateThread] bumpTimestampMs is too close to now. bumpTimestampMs: %s, lastActivityTs: %s, now: %s, description: %s, threadLifecycleState: %s, mawThread.authoritativeThreadKey is null: %s",s,g.lastActivityTs,a,r,b==null?void 0:b.type,g.authoritativeThreadKey==null?"true":"false");s=g.instanceKey;s!=null&&d("MAWThreadMappingQPL").pendingThreadCreationOnServer.set((j||(j=d("I64"))).to_string(f),s);return d("MAWThreadMappingQPL").measurePerformanceForNullableInstanceKey("create_e2ee_metadata_thread_sproc",s,function(){return c("LSCreateE2EEMetadataThreadStoredProcedure")(h,{bumpTimestampMs:m,createdByLocalDevice:null,folderType:o,offlineThreadKey:e,threadType:q,waJid:f})})}g.maybeUpdateMappingTableAndUpgradeOptimisticActThreadInMI=a;g.upgradeOptimisticActThreadInMI=q}),98);
__d("MAWThreadDefaults",["fbt","I64","LSBitOffset","LSIntEnum","qex"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;function k(){if(c("qex")._("327")===!0)return!0;else return c("qex")._("121")===!0}function a(a){if(k())return d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(42),a);else return a}function b(a){return d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(4),a)}e=d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(18),d("LSBitOffset").set(j.ofNumber(56),d("LSBitOffset").set(j.ofNumber(14),d("LSBitOffset").set(j.ofNumber(23),d("LSBitOffset").set(j.ofNumber(8),d("LSBitOffset").set(j.ofNumber(15),d("LSBitOffset").set(j.ofNumber(2),d("LSBitOffset").empty)))))));f=a(b(d("LSBitOffset").set(j.ofNumber(7),d("LSBitOffset").set(j.ofNumber(6),d("LSBitOffset").set(j.ofNumber(9),d("LSBitOffset").set(j.ofNumber(10),d("LSBitOffset").set(j.ofNumber(19),d("LSBitOffset").set(j.ofNumber(35),d("LSBitOffset").set(j.ofNumber(3),d("LSBitOffset").set(j.ofNumber(43),e))))))))));a=d("LSBitOffset").set(j.ofNumber(17),d("LSBitOffset").set(j.ofNumber(60),d("LSBitOffset").set(j.ofNumber(16),d("LSBitOffset").set(j.ofNumber(26),d("LSBitOffset").set(j.ofNumber(28),d("LSBitOffset").clear(j.ofNumber(27),f))))));b=d("LSBitOffset").set((i||(i=d("I64"))).sub(j.ofNumber(103),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(85),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(109),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(74),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(65),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(64),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(106),i.of_string("64")),d("LSBitOffset").empty)))))));e=h._(/*BTDS*/"__JHASH__9ZFn8zMzjpf__JHASH__").toString();h=d("LSBitOffset").set(i.sub(j.ofNumber(172),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(170),i.of_string("64")),d("LSBitOffset").empty));g.defaultThreadCapabilities=f;g.defaultGroupThreadCapabilities=a;g.defaultThreadCapabilities_2=b;g.nullstateDescriptionText1=e;g.defaultThreadCapabilities_3=h;g.defaultThreadCapabilities_4=d("LSBitOffset").empty;g.defaultThreadCapabilities_5=d("LSBitOffset").empty}),226);
__d("MAWBridgeOccamadilloVerifyThreadExistsHandler",["FBLogger","I64","LSAuthorityLevel","LSThreadBitOffset","MAWActThreadMapping","MAWBridgeFireAndForget","MAWCreateOptimisticMiThreadForActThread","MAWJids","MAWLoggerDeferred","MAWMiActGetThreadLifecycleState","MAWMiActThreadLifecycleState","MAWThreadDefaults","MAWThreadMappingQPL","MAWThreadMappingState","MAWTimeUtils","Promise","WATimeUtils","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Thread loading complete: jid ",", threadKey ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] New authoritative thread: jid ",", threadKey: ","), state: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Authoritative thread not found for clientThreadKey: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Thread is missing in verify thread exists"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Last activity ts = 0 from MI for thread: ",", using local state ts: ",""]);n=function(){return a};return a}function o(a,b,c){a=a;(i||(i=d("I64"))).equal(a,(i||(i=d("I64"))).zero)&&(void d("MAWLoggerDeferred").WARN(n(),(i||(i=d("I64"))).to_string(c),i.to_string(b)),a=b);return a}var p=[105,17,25,24];function q(a,b){var c=p.filter(function(b){return d("LSThreadBitOffset").has(b,a)}),e=61,f=267,g=d("LSThreadBitOffset").has(e,a),h=d("LSThreadBitOffset").has(f,a);g&&c.push(e);h&&c.push(f);return d("LSThreadBitOffset").set(c,b?d("MAWThreadDefaults").defaultGroupThreadCapabilities:d("MAWThreadDefaults").defaultThreadCapabilities,d("MAWThreadDefaults").defaultThreadCapabilities_2,d("MAWThreadDefaults").defaultThreadCapabilities_3,d("MAWThreadDefaults").defaultThreadCapabilities_4,d("MAWThreadDefaults").defaultThreadCapabilities_5)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=(yield a.threads.get(c));if(f==null){void d("MAWLoggerDeferred").ERROR(m());return(h||(h=b("Promise"))).resolve()}var g=e.clientThreadKey!=null?(i||(i=d("I64"))).of_string(e.clientThreadKey):f.clientThreadKey,j=o(f.lastActivityTimestampMs,d("MAWTimeUtils").millisTimeToTimestamp(e.lastActivityTs),c);e=q(f,e.isGroup);return a.threads.upsert([c],babelHelpers["extends"]({},f,{capabilities:e[0],capabilities2:e[1],capabilities3:e[2],capabilities4:e[3],capabilities5:e[4],clientThreadKey:g,lastActivityTimestampMs:j}))});return s.apply(this,arguments)}function t(a,b,c,d){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){yield (h||(h=b("Promise"))).all([d("MAWThreadMappingState").markActThreadMappingAsCompleted(a,{intJid:e,threadKey:c},f.instanceKey),x(a,c,f)])});return u.apply(this,arguments)}function v(a,b,c){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){(i||(i=d("I64"))).equal(b,c)||(yield a.threads["delete"](c))});return w.apply(this,arguments)}function x(a,b,c){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=e.clientThreadKey,g=e.instanceKey,j=e.isGroup,k=e.lastActivityTs;yield d("MAWThreadMappingQPL").measurePerformanceForNullableInstanceKey("handle_existing_thread",g,function(){return(h||(h=b("Promise"))).all([r(a,c,{clientThreadKey:f,isGroup:j,lastActivityTs:k}),f!=null&&v(a,c,(i||(i=d("I64"))).of_string(f))])})});return y.apply(this,arguments)}function z(a,b,c){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield a.threads.get(b));f!=null&&(i||(i=d("I64"))).to_int32(f.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE?yield x(a,b,e):e.instanceKey!=null&&d("MAWThreadMappingQPL").handleExistingThreadFail(e.instanceKey,f);f==null&&void d("MAWLoggerDeferred").LOG(l(),e.clientThreadKey)});return A.apply(this,arguments)}function B(a,b){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b.authoritativeThreadKey,f=b.clientThreadKey,g=b.description,h=b.folder,l=b.instanceKey,m=b.isGroup,n=b.jid;b=b.lastActivityTs;var o=d("MAWJids").convertChatJidToIntJid(n),p=(yield d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJidOrThreadKey(a,o,e,"MAWBridgeOccamadilloVerifyThreadExistsHandler"));l!=null&&d("MAWThreadMappingQPL").addAnnotations({string:{threadStateInOccamVTE:p.type.toString()}},l);switch(p.type){case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY:return d("MAWCreateOptimisticMiThreadForActThread").maybeUpdateMappingTableAndUpgradeOptimisticActThreadInMI(a,{authoritativeThreadKey:e,clientThreadKey:f,description:g,folder:h,instanceKey:l,intJid:o,isGroup:m,lastActivityTs:b},p).then(function(){return{previousState:p.type}});case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:e=(i||(i=d("I64"))).to_string(p.serverThreadKey);void d("MAWLoggerDeferred").LOG(k(),n,e,p.type);return t(a,p.serverThreadKey,o,{clientThreadKey:f,instanceKey:l,isGroup:m,lastActivityTs:b}).then(function(){return{previousState:p.type}});case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:h=(i||(i=d("I64"))).to_string(p.serverThreadKey);void d("MAWLoggerDeferred").LOG(j(),n,h);return z(a,p.serverThreadKey,{clientThreadKey:f,instanceKey:l,isGroup:m,lastActivityTs:b}).then(function(){return{previousState:p.type}});case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:throw c("FBLogger")("messenger_web").mustfixThrow("[Occam] Unimplemented VerifyThreadExists state: %s for JID: %s, from %s",p.type,n,g);default:p.type;throw c("FBLogger")("messenger_web").mustfixThrow("[Occam] Unhandled VerifyThreadExists state: %s for JID: %s, from %s",p.type,n,g)}});return C.apply(this,arguments)}function D(a,b,c,d){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){yield d("MAWThreadMappingQPL").measurePerformanceForNullableInstanceKey("insert_ephemeral_cache",f,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield a.threads.get(c));if(b!=null){var f;b={ephemeralExpirationInSec:(i||(i=d("I64"))).to_int32((f=b.disappearingSettingTtl)!=null?f:(i||(i=d("I64"))).zero),ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castMilliSecondsToUnixTime(i.to_float((f=b.disappearingSettingUpdatedTs)!=null?f:(i||(i=d("I64"))).zero))};d("MAWBridgeFireAndForget").fireAndForget("backend","setEphemeralSettingCache",{jid:e,settings:b})}}))});return E.apply(this,arguments)}function a(a,b){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.authoritativeThreadKey,d=b.clientThreadKey,e=b.description,f=b.folder,g=b.instanceKey,h=b.isGroup,i=b.jid;b=b.lastActivityTs;yield H(a,{authoritativeThreadKey:c,clientThreadKey:d,description:(a=e)!=null?a:"unknown",folder:f,instanceKey:g,isGroup:h,jid:i,lastActivityTs:b})});return F.apply(this,arguments)}function e(a,b){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.authoritativeThreadKey,d=b.clientThreadKey,e=b.description,f=b.folder,g=b.instanceKey,h=b.isGroup,i=b.jid;b=b.lastActivityTs;yield H(a,{authoritativeThreadKey:c,clientThreadKey:d,description:e,folder:f,instanceKey:g,isGroup:h,jid:i,lastActivityTs:b})});return G.apply(this,arguments)}function H(a,b){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b.authoritativeThreadKey,f=b.clientThreadKey,g=b.description,h=b.instanceKey,j=b.jid;h!=null&&d("MAWThreadMappingQPL").addPoint("occam_verify_thread_exists_start",h);var k=c("gkx")("11539");k&&d("MAWActThreadMapping").executePromisesBlockedOnActThreadMapping({authoritativeThreadKey:e,description:g,instanceKey:h,jid:j,optimisticThreadKey:f});var l=(yield B(a,b));l=l.previousState;k||d("MAWActThreadMapping").executePromisesBlockedOnActThreadMapping({authoritativeThreadKey:e,description:g,instanceKey:h,jid:j,optimisticThreadKey:f});g=(k=e)!=null?k:f;e=g!=null?(i||(i=d("I64"))).of_string(g):null;e!=null&&l!==d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE&&(yield D(a,e,j,h));if(h!=null){d("MAWThreadMappingQPL").addPoint("occam_verify_thread_exists_end",h);k=d("MAWJids").convertChatJidToIntJid(b.jid);d("MAWThreadMappingQPL").pendingThreadCreationOnServer.has((i||(i=d("I64"))).to_string(k))||(yield d("MAWThreadMappingQPL").end({instanceKey:h,intJid:k,tables:a,threadKey:e}))}});return I.apply(this,arguments)}g.genUpdatesForAuthoritativeThread=x;g.insertEphemeralCache=D;g.call=a;g.callFromMainThread=e}),98);
__d("MAWCommonSetupBridge",["BrowserLockManager","CurrentAppID","CurrentUser","FBLogger","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWBridge","MAWChatJid","MAWCrossWorkerPortal","MAWCurrentUser","MAWDbMedia","MAWEBSwitch","MAWInit","MAWJobActionsV2","MAWMIC","MAWReportSendMessageSuccessResult","MAWThreadCutover","MAWThreadUtils","MWLogSend","ODS","Promise","QPLEvent","QPLUserFlow","WACrossWorkerPortal","WADevToolMessageChannel","WADevToolsBridge","WAExceededStorageQuota","WAJids","cr:2691","gkx","justknobx","pageID","performanceAbsoluteNow","promiseDone","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonSetupBridge"),p=new Set([25312111,25311870]),q=new Map();e=new Map([[(a=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,8],[a.MEDIA_TYPE.VIDEO,10],[a.MEDIA_TYPE.GIF,6],[a.MEDIA_TYPE.STICKER,4],[a.MEDIA_TYPE.PTT,11],[a.MEDIA_TYPE.DOCUMENT_FILE,9]]);var r=new Set([25312150,25313100,1056840931,25299294]),s=function(){return(n||(n=c("performanceAbsoluteNow")))()-Date.now()},t=s();function u(a,b,e){return(i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(f){return d("MAWThreadCutover").isCutoverSecureThreadFromChatJid(f,a).then(function(a){c("QPLUserFlow").addAnnotations(b,{bool:{is_cutover:a}},{instanceKey:e})})})}var v=/[^a-zA-Z0-9._-]/g,w=/[.]+/g,x=/[\s_.-]+/g;function y(a){return a.replace(x,".").replace(v,"").replace(w,".")}var z={handleMessageSendResult:function(a){a.success&&d("MAWReportSendMessageSuccessResult").reportSendMessageSuccessResult(a.report)},log:function(a){var b=a.logLevel,c=a.logString,e=a.tags;a=e.length>0;var f=""+(d("CurrentAppID").getAppID()||"unknown");switch(b){case"count":(j||(j=d("ODS"))).bumpEntityKey(3185,y("e2ee."+(a?e.join("."):c)),y("count."+(a?c+"."+f:f)),1);o.onReadyImmediately(function(a){a=a.count;return a(c,e)});return;case"log":o.onReadyImmediately(function(a){a=a.info;return a(c,e)});return;case"warn":o.onReadyImmediately(function(a){a=a.warn;return a(c,e)});return;case"logRestricted":o.onReadyImmediately(function(a){a=a.logRestricted;return a(c,e)});return;case"debug":break;case"error":break;default:break}},logError:function(a){var b=a.entriesToReport,c=a.framesToPop,d=a.logString,e=a.message,f=a.stack,g=a.tags;o.onReadyImmediately(function(a){a=a.logError;return a(d,g,e,f,c,b)})},odsBumpEntityKey:function(a){var b=a.amount,c=a.entity;a=a.key;(j||(j=d("ODS"))).bumpEntityKey(3185,c,a+"."+(d("CurrentAppID").getAppID()||"unknown"),b)},onJobFinished:function(a){a.type==="createGroup"&&a.originalArgs.key!=null&&d("MAWJobActionsV2").recentFinishedJobsCache.set(a.originalArgs.key,a.result);switch(a.type){case"sendAppData":var b=a.originalArgs,e=a.result;(b=b.args.contents.actions)==null?void 0:b.forEach(function(a){a=a.messageAction;if(a==null||a.type!=="delete_for_me"||e.type!=="not_sent")return;q.set(e.appDataExternalId,{chatJid:a.protocolMsgId.chat,externalId:a.protocolMsgId.externalId,type:"deleteMsgForMe"})});break}if(a.type==="sendWrittenAppData"){b=a.originalArgs.appDataExternalId;var f=q.get(b);q["delete"](b);if(f!=null&&f.type==="deleteMsgForMe"&&a.result.type==="success"){var g=f.chatJid,h=f.externalId,j=d("MAWThreadUtils").getLSThreadTypeFromJid(g);c("promiseDone")((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(a){c("promiseDone")(d("MAWChatJid").toThreadKey(a.tables,g,"MAWCommonSetupBridge::sendWrittenAppData").then(function(b){d("MWLogSend").log(a,{actor:(k||(k=d("I64"))).of_string(d("MAWCurrentUser").getID()),attachmentFbids:[],attachmentType:25,backend:1,hasReply:!1,messagingThreadId:k.to_string(b),offlineThreadingId:h,sendType:3,source:(l||(l=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),threadKey:b,threadType:j})}))}))}}},qplEvent:function(a){var e=a.action,f=a.annotations,g=a.debugInfo,i=a.error,j=a.event,k=a.instanceKey,l=a.performanceAndDateSkew,n=a.timeoutInMs;a=a.timestamp;if(!c("CurrentUser").isEmployee()&&p.has((m||(m=d("QPLEvent"))).getMarkerId(j)))return;var o=k||0;k=f==null?void 0:(k=f.string)==null?void 0:k.jid;k=k!=null?d("WAJids").validateChatJid(k):void 0;k=r.has((m||(m=d("QPLEvent"))).getMarkerId(j))&&k!=null?u(k,j,o):(h||(h=b("Promise"))).resolve();var q=a!=null&&l!=null&&c("gkx")("8334")?a+l-t+s():a;switch(e.type){case"start":c("QPLUserFlow").start(j,{annotations:babelHelpers["extends"]({},f||{},{bool:babelHelpers["extends"]({},(f==null?void 0:f.bool)||{},{is_eb_enabled:c("MAWEBSwitch").isEnabled(),is_pdb:c("gkx")("8483"),isArmadilloPublicLaunchUser:c("gkx")("23405"),isDev:0,isGifSearchEnbled:!0,isLockApiSupported:c("BrowserLockManager")!=null,isRestoreDBEnabled:c("gkx")("23906"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()})}),instanceKey:o,timeoutInMs:n,timestamp:q});break;case"success":c("QPLUserFlow").addAnnotations(j,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:o});k["finally"](function(){c("QPLUserFlow").endSuccess(j,{annotations:f,instanceKey:o,timestamp:q})});break;case"cancel":c("QPLUserFlow").addAnnotations(j,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:o});k["finally"](function(){c("QPLUserFlow").endCancel(j,{annotations:f,instanceKey:o,timestamp:q})});break;case"point":f&&c("QPLUserFlow").addAnnotations(j,f,{instanceKey:o});(m||(m=d("QPLEvent"))).getMarkerId(j)===1056839232?d("MAWMIC").addPoint(e.name,q):c("QPLUserFlow").addPoint(j,e.name,{instanceKey:o,timestamp:q});break;case"annotations":c("QPLUserFlow").addAnnotations(j,(l=f)!=null?l:{},{instanceKey:o});break;case"failure":c("QPLUserFlow").addAnnotations(j,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{failureReason:e.name}},{instanceKey:o});k["finally"](function(){c("QPLUserFlow").endFailure(j,e.name,{annotations:f,instanceKey:o,timestamp:q})});break;case"error":c("QPLUserFlow").markError(j,e.name,{debugInfo:g,error:i,instanceKey:o});break;default:throw c("FBLogger")("messenger_web").mustfixThrow("Bridge sends unreachable qplEvent action type")}}},A=function(a,b){a.push(b);return a};f=function(a){var e=a.customizeEventHandlers;a=a.worker;d("MAWInit").MAWInit.logPoint("bridge_setup_start");var f=d("MAWBridge").getBridge();f.setHandlers("event",babelHelpers["extends"]({},z,e));e=d("MAWCrossWorkerPortal").getOrCreateCrossWorkerPortal(f,["backend","mps"],A,{bridgeBatcherMaxTokens:Number.MAX_SAFE_INTEGER,portalCacheSize:c("justknobx")._("3092"),useLRUCache:c("gkx")("6949")});e.setPort(a);if(c("gkx")("3282")){var g=d("WADevToolsBridge").getDevToolBridge();a=new MessageChannel();var h=d("WACrossWorkerPortal").attachPortal(g,["backend"],A,c("pageID")),i=d("WACrossWorkerPortal").attachPortal(g,["devtool","mawDbDevTool"],A,c("pageID"));d("WADevToolMessageChannel").onCreateNewChannel(function(a){h.setPort(a.port1)});i.setPort(a.port1);b("cr:2691")==null?void 0:b("cr:2691").connectAddonPort(a.port2);e.addListener(function(a,b){return g.fireAndForget("devtool","bridgeMessage",{direction:b==="outgoing"?"toWorker":"toMain",msg:a,ts:Date.now()},!0)})}d("MAWMIC").addPoint("bridge_setup_done");d("MAWInit").MAWInit.logPoint("bridge_setup_end");return f};g.MEDIA_TYPE_TO_ATTACHMENT_TYPE=e;g.initBridge=f}),98);
__d("MAWGetAttachmentTypeForSendWrittenMsg",["MAWCommonSetupBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g,h,i){if(f)return 43;if(a==="revokeMsg")return 26;if(g!=null)return g;if(c)return 3;if(e&&h===!1)return 13;if(i===!0)return 13;f=b!=null?d("MAWCommonSetupBridge").MEDIA_TYPE_TO_ATTACHMENT_TYPE.get(b):null;return(a=f)!=null?a:0}g.getAttachmentTypeForSendWrittenMsg=a}),98);
__d("MAWReportSendMessageSuccessResult",["BrowserLockManager","FBLogger","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWChatJid","MAWCurrentUser","MAWFrontendMediaUtils","MAWGetAttachmentTypeForSendWrittenMsg","MAWThreadUtils","MAWVault","MAWXMAUtils","MWLogSend","MultipleTabsLogger","URLMatcher","WAJids","asyncToGeneratorRuntime","gkx","justknobx","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{a=(yield d("MAWChatJid").toThreadKey(a.tables,b,"MAWCommonSetupBridge::sendWrittenMsg"));return a}catch(a){if(c("gkx")("10750")){c("FBLogger")("messenger_e2ee_web_send").warn("MAWCommonSetupBridge::sendWrittenMsg failed to get threadKey. With error: %s",a);return(h||(h=d("I64"))).zero}throw a}});return l.apply(this,arguments)}function m(a){var e,f=a.externalId,g=null,l=!1,m=!1;switch(a.messageType){case"editMsg":l=!0;break;case"revokeMsg":f=a.referencedExternalId;break;case"sendMsg":m=a.specialTextSize!=null;break;case"reactionMsg":g=a.reaction!=null?20:27;break;case"bumpMsg":break;case"noteReplyMsg":break;case"sendPoll":break;case"fixMe":return;default:a.messageType}var n=null;a.fileType!=null&&(n=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.fileType).mediaType);var o=a.xmaMessageType!=null,p=a.quote!=null||d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType);e=c("URLMatcher").match(d("MAWVault").unvault((e=a.content)!=null?e:""));e=e!=null&&e.length>0;var q=d("MAWGetAttachmentTypeForSendWrittenMsg").getAttachmentTypeForSendWrittenMsg(a.messageType,n,m,o,l,g,p,e),r=d("MAWThreadUtils").getLSThreadTypeFromJid(a.chatJid);c("promiseDone")((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=(a==null?void 0:a.source)!=null?a.source:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),g=(yield k(b,a.chatJid)),i=d("WAJids").validateGroupJid(a.chatJid);d("MWLogSend").log(b,{actor:(h||(h=d("I64"))).of_string(d("MAWCurrentUser").getID()),attachmentFbids:[],attachmentType:q,backend:1,hasReply:p,initatingSource:a==null?void 0:a.initiatingSource,messagingThreadId:h.to_string(g),msgTtl:(b=a.ephemeralSetting)==null?void 0:b.ephemeralExpirationInSec,offlineThreadingId:f,sendType:1,source:e,threadKey:g,threadType:r,waGroupJid:c("gkx")("10750")&&i!=null?d("WAJids").threadIdForChatJid(i):void 0})});return function(a){return e.apply(this,arguments)}}()))}function a(a){if(c("justknobx")._("154")&&d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&(c("BrowserLockManager")!=null&&!d("MultipleTabsLogger").hasUniqueLock()))return;m(a)}g.reportSendMessageSuccessResultFn=m;g.reportSendMessageSuccessResult=a}),98);
__d("MAWGetEphemeralSettings",["I64","MAWBridgeSendAndReceive","MAWChatJid","ReQL","WAJids","WALogger","WATimeUtils","asyncToGeneratorRuntime","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ephemeral settings in memory]: MAWGetEphemeralSettings api call for chatJid "," returns ",""]);i=function(){return a};return a}var j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("MAWGetEphemeralSettings"),k=c("requireDeferred")("MAWEphemeralSettingsUpdate").__setRef("MAWGetEphemeralSettings");function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(d("WAJids").switchOnMsgrChatJidType(a,{group:function(){return!1},user:function(){return!0}})){var e=(yield j.load());e=(yield e());b=(b=b)!=null?b:yield d("MAWChatJid").toThreadKeyMaybe(e.tables,a);if(b!=null){e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.threads).getKeyRange(b)));if(e!=null&&e.disappearingSettingTtl!=null){b={ephemeralExpirationInSec:(h||(h=d("I64"))).to_int32(e.disappearingSettingTtl),ephemeralLastUpdatedOrSetTimestamp:e.disappearingSettingUpdatedTs!=null?d("WATimeUtils").castMilliSecondsToUnixTime((h||(h=d("I64"))).to_float(e.disappearingSettingUpdatedTs)):d("WATimeUtils").unixTime()};return b}return}return d("MAWBridgeSendAndReceive").sendAndReceive("backend","getEphemeralSettings",{threadId:a}).then(function(b){d("WALogger").LOG(i(),a,b);if(b!=null){c("promiseDone")(k.load().then(function(c){return c.updateEphemeralSettingsByChatJid(b.ephemeralExpirationInSec,b.ephemeralLastUpdatedOrSetTimestamp,!1,a,!0)}));return b}return void 0})}});return l.apply(this,arguments)}g.getEphemeralSetting=a}),98);
__d("MAWIsIDBOperational",["FBLogger","WebAsyncStorage","asyncToGeneratorRuntime","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";var h;e=h||d("react");var i=e.useEffect,j=e.useState;function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!1);if(a&&!c("WebAsyncStorage").isOpenPromiseSettled())return!1;a=(yield c("WebAsyncStorage").isOperational());if(!a.success){c("FBLogger")("messenger_web").catching(a.error).warn("Marking MAW IDB as unavailable: %s",a.error.message);return!1}return!0});return l.apply(this,arguments)}var m=!1;function a(){var a=j(m),b=a[0],d=a[1];i(function(){c("promiseDone")(k().then(function(a){d(a),m=a}))},[d]);return b}g.isIDBOperational=k;g.useIsIDBOperational=a}),98);
__d("MAWMainThreadLogger",["CurrentMessengerUser","FBLogger","MAWAppVersion","MAWConsoleLogger","MAWDeleteOldLogsFromDisk","MAWLeakDetection","MAWLoggerUtils","MAWLoggingSwitches","MAWSaveLogToDisk","Promise","WAJids","WATagsLogger","asyncToGeneratorRuntime","err","getErrorSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=!1;function a(){i=!1}function e(){i||(i=!0,d("WATagsLogger").initializeWaLogger(t))}var j=function(){return c("FBLogger")("messenger_web")};function k(a,b){a=l(a);a!=null&&d("MAWLoggerUtils").logToHistory("log",a,b,!1)}function l(a){if(!d("CurrentMessengerUser").isEmployee()&&!d("CurrentMessengerUser").isTestUser())return;a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);return a}function f(a,b){a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);d("MAWLoggerUtils").logToHistory("log",a,b,!1)}function m(a,b){a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);d("MAWLoggerUtils").logToHistory("log",a,b,!1)}function n(a,b){a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);j().tags(b.map(function(a){return String(a)})).warn(a)}function o(a,b,d,e,f,g){d=c("err")(d);d.stack=e;c("promiseDone")(r(a,b,d,f,g))}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=d("MAWLeakDetection").maybeReplaceVaultedString(d("WAJids").maybeSanitizeLogLineText(a));var e=d("MAWLoggingSwitches").removeLoggingFromBridge?d("MAWSaveLogToDisk").getLastNEntries(c):(h||(h=b("Promise"))).resolve([]);c=c===0?[]:[].concat((yield e).map(function(a){return a.args}));return{logs:[].concat(c),sanitizedMessage:a}});return q.apply(this,arguments)}function r(a,b,c,d,e){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var h;a=d("MAWLeakDetection").maybeReplaceVaultedString(d("WAJids").maybeSanitizeLogLineText(a));h=(h=e)!=null?h:c("err")(a);f=(a=f)!=null?a:e==null?2:0;e=(a=g)!=null?a:0;g=(yield p(h.message,e));a=g.logs;e=g.sanitizedMessage;g=c("getErrorSafe")(h);try{h.message=e}catch(a){g=c("err")(e,h.fileName,h.lineNumber)}f!==0&&(g.framesToPop=f);(h=j())==null?void 0:(f=h.addMetadata("MESSENGER_E2EE_WEB","APP_VERSION",d("MAWAppVersion").getVersionNumber()).tags(b.map(function(a){return String(a)})).catching(g)).mustfix.apply(f,[e].concat(a))});return s.apply(this,arguments)}var t={count:function(a,b){d("MAWConsoleLogger").logToConsole("count",a,b)},debug:function(a,b){d("MAWConsoleLogger").logToConsole("log",a,b)},devConsole:function(a,b,c){for(var e=arguments.length,f=new Array(e>3?e-3:0),g=3;g<e;g++)f[g-3]=arguments[g];switch(a){case"COUNT":d("MAWConsoleLogger").logToConsole.apply(void 0,["count",b,c].concat(f));break;case"DEV":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c].concat(f));break;case"DEV_XMPP":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c].concat(f));break;case"LOG":d("MAWConsoleLogger").logToConsole.apply(void 0,["info",b,c].concat(f));break;case"WARN":d("MAWConsoleLogger").logToConsole.apply(void 0,["warn",b,c].concat(f));break;case"ERROR":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c].concat(f));break;case"CATCHING":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c].concat(f));break}},error:function(a,b,e){c("promiseDone")(r(a,b,e)),d("MAWConsoleLogger").logToConsole("error",a,b)},info:function(a,b){m(a,b),d("MAWConsoleLogger").logToConsole("info",a,b)},logRestricted:function(a,b){k(a,b),d("MAWConsoleLogger").logToConsole("log",a,b)},warn:function(a,b){n(a,b),d("MAWConsoleLogger").logToConsole("warn",a,b)}};function u(){return!d("MAWLoggingSwitches").removeLoggingFromBridge?(h||(h=b("Promise"))).resolve([]):d("MAWSaveLogToDisk").getEntries()}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("MAWLoggingSwitches").removeLoggingFromBridge)return;yield d("MAWDeleteOldLogsFromDisk").clearLogs()});return w.apply(this,arguments)}function x(a){return new Date(typeof a==="string"?parseInt(a,10):a).toISOString().replace("T"," ").replace("Z","")}function y(a){return a.map(function(a){try{var b=x(a.date);return[b,a.level,a.category,a.event,a.args].join(" | ")}catch(a){return[x(Date.now()),"error","LOGGER","Error formatting log: "+((a==null?void 0:a.message)||"")].join(" | ")}}).filter(Boolean).join("\n")}g.__testClearLoggerSetup=a;g.setupMainWaLogger=e;g.logRestricted=k;g.count=f;g.info=m;g.warn=n;g.logError=o;g.getEntries=u;g.clearEntries=v;g.formatEntries=y}),98);
__d("WABridgedAPI",["IWAAPI"],(function(a,b,c,d,e,f,g){"use strict";b={queryGroups:(a=d("IWAAPI")).makeBridgedApi("queryGroups"),getDevices:a.makeBridgedApi("getDevices"),removeCurrentDevice:a.makeBridgedApi("removeCurrentDevice"),removeDevice:a.makeBridgedApi("removeDevice"),getCurrentUserDeviceList:a.makeBridgedApi("getCurrentUserDeviceList")};c=b;g["default"]=c}),98);